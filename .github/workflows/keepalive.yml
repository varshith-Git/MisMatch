name: Keepalive — Ping Render Backend

# Runs every 5 minutes, 24/7, for free on GitHub Actions.
# Sends a GET /health to the Render backend so it never hits
# the 15-minute inactivity threshold and cold-starts.

on:
  schedule:
    # Every 5 minutes (GitHub Actions minimum granularity is 5 min)
    - cron: '*/5 * * * *'
  workflow_dispatch: # allow manual trigger from GitHub UI

jobs:
  ping:
    name: Ping /health
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: Ping Render backend
        run: |
          echo "Pinging https://mismatch-cx4b.onrender.com/health ..."
          STATUS=$(curl --silent --output /dev/null --write-out "%{http_code}" \
            --max-time 30 \
            https://mismatch-cx4b.onrender.com/health)

          echo "Response status: $STATUS"

          if [ "$STATUS" != "200" ]; then
            echo "⚠️  Health check returned $STATUS — server may be cold-starting"
            exit 1
          fi

          echo "✅ Server is alive"
